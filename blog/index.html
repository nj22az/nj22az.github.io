<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog – The Office of Nils Johansson</title>
<script src="https://unpkg.com/feather-icons"></script>
<style>
:root {
  --background: #f7f7f7;
  --text-primary: #1c1c1e;
  --accent: #007aff;
  --card-bg: #ffffff;
  --border: #e0e0e0;
  --disabled: #c7c7cc;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
  background-color: var(--background);
  margin: 0;
  padding: 0;
  color: var(--text-primary);
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 80px 20px 100px;
}

h1 {
  text-align: center;
  color: var(--accent);
  margin-bottom: 2rem;
}

.intro {
  text-align: center;
  color: #3a3a3c;
  margin: 0 auto 2rem;
  max-width: 600px;
}

.intro a {
  color: inherit;
}

.post-card {
  background-color: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.post-card h2 {
  margin-top: 0;
  margin-bottom: 0.5rem;
}

.post-card h2 a {
  color: var(--accent);
  text-decoration: none;
}

.post-card .meta {
  font-size: 0.9rem;
  color: var(--disabled);
  margin-bottom: 1rem;
}

.post-card p {
  margin-bottom: 1rem;
}

.post-card .tags {
  margin-top: 1rem;
}

.post-card .tag {
  display: inline-block;
  background-color: #e5e5ea;
  color: var(--text-primary);
  padding: 0.2rem 0.5rem;
  border-radius: 6px;
  font-size: 0.8rem;
  margin-right: 0.3rem;
}

.status {
  text-align: center;
  background-color: #fff;
  border: 1px dashed var(--border);
  border-radius: 12px;
  padding: 1rem;
  color: #8e8e93;
}

.read-more {
  margin-top: 1rem;
}

.read-more a {
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
}

.read-more a:hover,
.intro a:hover {
  text-decoration: underline;
}
@media (max-width: 600px) {
  .container {
    padding: 60px 20px 80px;
  }
}
</style>
</head>
<body>
<div class="container">
  <h1>Blog</h1>
  <p class="intro">The latest stories from <a href="https://theofficeofnils.wordpress.com" target="_blank" rel="noopener">theofficeofnils.wordpress.com</a> pulled straight into this page.</p>
  <div id="status" class="status">Fetching the most recent posts…</div>
  <div id="posts"></div>
</div>
<script>
const postsContainer = document.getElementById('posts');
const statusBanner = document.getElementById('status');
const WORDPRESS_API = 'https://public-api.wordpress.com/wp/v2/sites/theofficeofnils.wordpress.com/posts?_embed&per_page=6';

function stripHTML(html) {
  const tmp = document.createElement('div');
  tmp.innerHTML = html;
  return tmp.textContent || tmp.innerText || '';
}

function safeText(input) {
  return stripHTML(input || '').trim();
}

function formatDate(dateString) {
  return new Intl.DateTimeFormat('en-US', { dateStyle: 'long' }).format(new Date(dateString));
}

function buildTags(post) {
  const tags = post?._embedded?.['wp:term']?.flat() || [];
  return tags
    .filter(tag => tag.taxonomy === 'post_tag')
    .slice(0, 5)
    .map(tag => `<span class="tag">${safeText(tag.name)}</span>`)
    .join('');
}

function createPostCard(post) {
  const title = safeText(post.title.rendered) || 'Untitled';
  const excerpt = safeText(post.excerpt.rendered);
  const summary = excerpt.length > 220 ? `${excerpt.slice(0, 217)}…` : excerpt;
  const tagsMarkup = buildTags(post);
  const author = safeText(post._embedded?.author?.[0]?.name) || 'Nils Johansson';

  return `
    <article class="post-card">
      <h2><a href="${post.link}" target="_blank" rel="noopener">${title}</a></h2>
      <div class="meta">By ${author} – ${formatDate(post.date)}</div>
      <p>${summary || 'Visit WordPress to read the full story.'}</p>
      ${tagsMarkup ? `<div class="tags">${tagsMarkup}</div>` : ''}
      <div class="read-more"><a href="${post.link}" target="_blank" rel="noopener">Read the full article</a></div>
    </article>
  `;
}

async function loadPosts() {
  try {
    const response = await fetch(WORDPRESS_API);
    if (!response.ok) {
      throw new Error(`Request failed: ${response.status}`);
    }

    const posts = await response.json();
    if (!posts.length) {
      statusBanner.textContent = 'No posts are available yet. Please check back soon!';
      return;
    }

    statusBanner.remove();
    postsContainer.innerHTML = posts.map(createPostCard).join('');
  } catch (error) {
    console.error('Failed to load WordPress posts', error);
    statusBanner.textContent = 'We could not reach the WordPress blog right now. Try refreshing the page in a moment.';
  }
}

loadPosts();
feather.replace();
</script>
</body>
</html>
